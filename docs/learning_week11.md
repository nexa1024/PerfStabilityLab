# Week 11：协程稳定性（取消/异常/结构化并发）+ 算法综合（minSdk 26）

> 本周目标：把协程从“会用”提升到“可排错”：取消为何没生效、异常为何会传染、scope 选错为何会泄漏或全局崩。  
> 本周交付：2–3 个协程事故 Demo（取消/异常/生命周期）+ 协程排错清单。

---

## 每日固定配方（90 分钟）

- 15m 算法：综合题 1 道（回顾前面模板）
- 45m 阅读 + 笔记：结构化并发/取消/异常传播/Flow 直觉
- 25m Demo：复现协程坑 → 修复 → 验证
- 5m 输出：卡片 1 张

---

## Day 1：结构化并发与取消传播

- 算法：综合题 1 道（你最弱模板）。
- 阅读笔记：写《结构化并发 3 个关键词》
  - scope、父子 Job、取消传播
- Demo：`CoroutineLab`（新建实验页）骨架：复现/修复/验证 + 日志。
- 输出卡片：《取消会从哪里传到哪里》。

验收：你能解释“取消为什么会传播/不传播”。

---

## Day 2：事故 1 — 取消不生效（阻塞/未检查取消）

- 算法：综合题 1 道。
- 阅读笔记：写《取消不生效的常见原因》
  - 阻塞调用、未合作检查、用错 dispatcher
- Demo：
  - 复现：启动一个长任务，但内部不检查取消（或用阻塞方式）
  - 修复：使用可取消的挂起点/检查 `isActive`/改到合适 dispatcher
  - 验证：点击“修复”后取消能及时生效（日志证明）
- 输出卡片：《取消不生效：两句排查》。

验收：你能在 Demo 里明显看到“修复前取消无效、修复后有效”的对照。

---

## Day 3：事故 2 — 异常传播导致“全家桶失败”

- 算法：综合题 1 道。
- 阅读笔记：写《异常传播直觉》
  - 子协程异常如何影响父协程/兄弟协程（到能解释）
- Demo：
  - 复现：在同一个 scope 启两个任务，其中一个抛异常导致整体取消
  - 修复：用 `supervisorScope`/`SupervisorJob` 或局部 `try/catch` 隔离
  - 验证：修复后一个任务失败不再取消其他任务（日志证明）
- 输出卡片：《异常隔离：我用什么手段》。

验收：你能解释“为什么 supervisor 能隔离异常”。

---

## Day 4：Flow 与生命周期（收集未取消导致泄漏/浪费）

- 算法：综合题 1 道。
- 阅读笔记：写《Flow 冷/热 + 取消与生命周期》
  - 冷流：收集才执行；热流：一直在产出；生命周期决定取消时机
- Demo：
  - 复现：在错误的 scope 里收集 Flow（导致页面退出仍在执行/打印）
  - 修复：改到合适的 scope（如 `viewLifecycleOwner.lifecycleScope`）并在合适状态收集
  - 验证：退出页面后不再打印/不再占用
- 输出卡片：《Flow 收集：我放在哪个 scope》。

验收：你能用日志证明“退出页面后任务停止”。

---

## Day 5：协程排错清单固化

- 算法：错题复盘 1 题。
- 阅读笔记：输出《协程排错清单（1 页）》
  - scope 选择、取消传播、异常隔离、阻塞调用、dispatcher 选择
- Demo：把 `CoroutineLab` 的验证结论输出格式固定为 2 行（证据+结论）。
- 输出卡片：《协程事故复盘模板》。

验收：你能把协程问题用“证据链语言”表达：在哪里启动/为何没停/怎么修/怎么验证。

---

## Day 6：周复盘（协程事故 Demo 固化）

- 算法：补短板 1 题。
- 阅读笔记：整理《Week11：协程常见坑库》（至少 3 条）。
- Demo：确保取消/异常/生命周期三类事故都能复现并可验证修复。
- 输出卡片：《Week11 我能排查的协程问题》。

本周验收：你能用 Demo 现场演示 2–3 个协程坑，并解释修复为何有效。

