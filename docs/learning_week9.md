# Week 9：ANR 专题（输入/广播/Service/锁）+ 图/并查集（minSdk 26）

> 本周目标：理解 ANR 的触发机制与证据来源，能从线程栈/trace 找到“主线程在干什么/在等什么”；Demo 里以“接近 ANR 的卡死/卡顿”为主，避免开发设备反复真 ANR 影响效率。  
> 本周交付：ANR 排查顺序清单 + 1–2 个可控“接近 ANR”实验 + 一份 ANR 证据链复盘稿。

---

## 每日固定配方（90 分钟）

- 15m 算法：图/BFS/并查集（理解场景）1 题
- 45m 阅读 + 笔记：ANR 类型与证据（线程栈/trace）
- 25m Demo：复现卡死形态 → 记录主线程状态 → 规避 → 再验证
- 5m 输出：卡片 1 张

---

## Day 1：ANR 分类与超时机制（到能解释）

- 算法：并查集入门 1 题（连通性）。
- 阅读笔记：写《ANR 的三类常见入口》
  - 输入事件、广播、服务（各自的超时直觉）
- Demo：`AnrLab` 增加说明区：本周关注“主线程卡死/等待”而不是刷工具花活。
- 输出卡片：《ANR 一句话定义》。

验收：你能说清“ANR 本质是主线程长时间不响应”以及“常见入口”。

---

## Day 2：实验 — 接近 ANR 的主线程阻塞（可控）

- 算法：BFS/拓扑排序理解题 1 道。
- 阅读笔记：写《主线程阻塞为何会升级为 ANR》
  - 事件无法处理、超时触发、系统判定无响应
- Demo：
  - `AnrLab`
    - 复现：主线程阻塞较长时间（例如 2–5 秒，不必真的触发系统 ANR）
    - 修复：把耗时移出主线程
    - 验证：trace/日志证明主线程不再出现长时间阻塞 section
- 输出卡片：《接近 ANR 的证据怎么写》。

验收：你能在不触发真 ANR 的情况下，展示“主线程长阻塞”的证据。

---

## Day 3：实验 — 锁等待型“卡死”与定位

- 算法：图综合题 1 道。
- 阅读笔记：写《ANR 排查：先看主线程栈，再看锁与等待》
- Demo：
  - `AnrLab` 复用锁等待实验（或引用 `LockJankLab` 的机制）
    - 复现：主线程等待锁/等待后台完成
    - 修复：避免主线程等待（拆分、异步、超时/降级）
    - 验证：主线程等待时间明显下降
- 输出卡片：《锁等待型 ANR：两句话根因》。

验收：你能解释“主线程在等谁、为什么等、怎么避免等”。

---

## Day 4：线程栈（或等价栈信息）读法

- 算法：并查集/图补短板 1 题。
- 阅读笔记：写《线程栈读法最小步骤》
  - 找 main 线程 → 看 top frame → 看是否 waiting/blocked → 找持有者/调用链
- Demo：
  - `AnrLab` 的“验证”按钮：把“如何读栈”的步骤写进日志区（后面可以贴真实栈样例）。
- 输出卡片：《读栈三步》。

验收：你能拿任意一个线程栈片段，用 60 秒说出“main 在干什么/等什么”。

---

## Day 5：输出《ANR 排查顺序清单》

- 算法：错题复盘 1 题。
- 阅读笔记：输出《ANR 排查顺序：先栈→再锁→再 Binder/IO》（1 页）。
- Demo：把 `AnrLab` 的复现/修复/验证都跑通一次并落盘结论。
- 输出卡片：《ANR 证据链模板》。

验收：能把 ANR 说成“证据驱动”的排查过程，而不是凭猜。

---

## Day 6：周复盘（ANR 证据链一份）

- 算法：补短板 1 题（图/并查集任选）。
- 阅读笔记：写《Week9：ANR 证据链复盘稿》。
- Demo：整理 `AnrLab` 的安全开关（避免误触发真 ANR）。
- 输出卡片：《Week9 我能解释的 ANR 形态》。

本周验收：你能用 Demo 演示“主线程阻塞/锁等待导致无响应”的证据链，并能按清单讲清排查顺序。

